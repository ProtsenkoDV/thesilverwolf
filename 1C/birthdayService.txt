Функция ИменинникиПолучить(Запрос)
	
	//{{КОНСТРУКТОР_ЗАПРОСА_С_ОБРАБОТКОЙ_РЕЗУЛЬТАТА
	// Данный фрагмент построен конструктором.
	// При повторном использовании конструктора, внесенные вручную изменения будут утеряны!!!
	ДоДняРождения = ЧИСЛО(Запрос.ПараметрыURL["count"]);
	
	ЗапросКБазе = Новый Запрос;
	ЗапросКБазе.Текст = 
		"ВЫБРАТЬ
		|	ФизическиеЛица.Наименование КАК Наименование,
		|	ФизическиеЛица.ДатаРождения КАК ДатаРождения,
		|	СостоянияСотрудниковСрезПоследних.Состояние КАК Состояние,
		|	ТекущиеКадровыеДанныеСотрудников.ТекущееПодразделение КАК Подразделение,
		|	ТекущиеКадровыеДанныеСотрудников.ТекущаяДолжность КАК Должность
		|ИЗ
		|	РегистрСведений.СостоянияСотрудников.СрезПоследних КАК СостоянияСотрудниковСрезПоследних
		|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.ФизическиеЛица КАК ФизическиеЛица
		|			ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ТекущиеКадровыеДанныеСотрудников КАК ТекущиеКадровыеДанныеСотрудников
		|			ПО ТекущиеКадровыеДанныеСотрудников.ФизическоеЛицо = ФизическиеЛица.Ссылка
		|		ПО (ФизическиеЛица.Ссылка = СостоянияСотрудниковСрезПоследних.Сотрудник.ФизическоеЛицо.Ссылка)
		|ГДЕ
		|	ТекущиеКадровыеДанныеСотрудников.ОсновноеРабочееМестоВОрганизации = ИСТИНА
		|	И СостоянияСотрудниковСрезПоследних.ДействуетДо = ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
		|
		|УПОРЯДОЧИТЬ ПО
		|	МЕСЯЦ(ФизическиеЛица.ДатаРождения),
		|	ДЕНЬ(ФизическиеЛица.ДатаРождения)";
	
	РезультатЗапроса = ЗапросКБазе.Выполнить();
	
	ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
	ДанныеОСотрудниках="";
	
	
	
	ГраницаПоиска = (ДАТА(Число(Формат(ГОД(ТекущаяДата()),"ЧГ=0")),Месяц(ТекущаяДата()),День(ТекущаяДата())))+(ДоДняРождения*24*60*60);
	МассивСотрудников = Новый Массив;
	Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
		
		Если Строка(ВыборкаДетальныеЗаписи.Состояние)<>"Увольнение" 
			Тогда
			Попытка
				ДеньРождениеСотрудника = ДАТА(Число(Формат(ГОД(ГраницаПоиска),"ЧГ=0")),МЕСЯЦ(ВыборкаДетальныеЗаписи.ДатаРождения),ДЕНЬ(ВыборкаДетальныеЗаписи.ДатаРождения));
			Исключение
				ДеньРождениеСотрудника = ДАТА(Формат(ГОД(ГраницаПоиска),"ЧГ=0"),МЕСЯЦ(ВыборкаДетальныеЗаписи.ДатаРождения),28);
			КонецПопытки;
			РазностьДней = ДеньРождениеСотрудника-ДАТА(Число(Формат(ГОД(ТекущаяДата()),"ЧГ=0")),Месяц(ТекущаяДата()),День(ТекущаяДата()));
			РазностьДней = (((РазностьДней/24)/60)/60)*-1;
			Если Число(Формат(ГОД(ГраницаПоиска),"ЧГ=0"))>Число(Формат(ГОД(ТекущаяДата()),"ЧГ=0")) И РазностьДней<=0 И РазностьДней>=ДоДняРождения*-1  Тогда
				Возраст = Формат(ГОД(ГраницаПоиска),"ЧГ=0")-Формат(ГОД(ВыборкаДетальныеЗаписи.ДатаРождения));
				МассивСотрудников.Добавить(СТРОКА(ФОРМАТ(ДеньРождениеСотрудника,"ДФ=ггггММдд"))+"$"+ВыборкаДетальныеЗаписи.Наименование+"$"+ВыборкаДетальныеЗаписи.ДатаРождения+"$"+ВыборкаДетальныеЗаписи.Подразделение+"$"+ВыборкаДетальныеЗаписи.Должность+"$"+Возраст+"$"+РазностьДней+"#");
				//ДанныеОСотрудниках = ДанныеОСОтрудниках+ВыборкаДетальныеЗаписи.Наименование+"$"+ВыборкаДетальныеЗаписи.ДатаРождения+"$"+ВыборкаДетальныеЗаписи.Подразделение+"$"+ВыборкаДетальныеЗаписи.Должность+"#";
			Иначе		
				Попытка
				ДеньРождениеСотрудника = ДАТА(Число(Формат(ГОД(ТекущаяДата()),"ЧГ=0")),МЕСЯЦ(ВыборкаДетальныеЗаписи.ДатаРождения),ДЕНЬ(ВыборкаДетальныеЗаписи.ДатаРождения));
			Исключение
				ДеньРождениеСотрудника = ДАТА(Число(Формат(ГОД(ТекущаяДата()),"ЧГ=0")),МЕСЯЦ(ВыборкаДетальныеЗаписи.ДатаРождения),28);
				КонецПопытки;
				РазностьДней = ДеньРождениеСотрудника-ДАТА(Число(Формат(ГОД(ТекущаяДата()),"ЧГ=0")),Месяц(ТекущаяДата()),День(ТекущаяДата()));
				РазностьДней = (((РазностьДней/24)/60)/60);
				Если  ДеньРождениеСотрудника<ГраницаПоиска И РазностьДней>=0 И РазностьДней<=ДоДняРождения Тогда
					Возраст = Формат(ГОД(ГраницаПоиска),"ЧГ=0")-Формат(ГОД(ВыборкаДетальныеЗаписи.ДатаРождения));
					МассивСотрудников.Добавить(СТРОКА(ФОРМАТ(ДеньРождениеСотрудника,"ДФ=ггггММдд"))+"$"+ВыборкаДетальныеЗаписи.Наименование+"$"+ВыборкаДетальныеЗаписи.ДатаРождения+"$"+ВыборкаДетальныеЗаписи.Подразделение+"$"+ВыборкаДетальныеЗаписи.Должность+"$"+Возраст+"$"+РазностьДней+"#");
				//	ДанныеОСотрудниках = ДанныеОСОтрудниках+ВыборкаДетальныеЗаписи.Наименование+"$"+ВыборкаДетальныеЗаписи.ДатаРождения+"$"+ВыборкаДетальныеЗаписи.Подразделение+"$"+ВыборкаДетальныеЗаписи.Должность+"#";
				КонецЕсли;					
			КонецЕсли;						
			КонецЕсли;	
	//КонецЕсли;
КонецЦикла;
	СписокЗначений = Новый СписокЗначений;
	СписокЗначений.ЗагрузитьЗначения(МассивСотрудников);
	СписокЗначений.СортироватьПоЗначению();
	МассивСотрудников = СписокЗначений.ВыгрузитьЗначения();
	
	Для каждого Сотрудник из МассивСотрудников ЦИКЛ
		ДанныеОСотрудниках=ДанныеОСотрудниках+Сотрудник;	
	КонецЦикла;
	
	Ответ = Новый HTTPСервисОтвет(200);
	Ответ.Заголовки.Вставить("Content-Type","text/html; charset=utf-8");
	Ответ.УстановитьТелоИзСтроки(ДанныеОСотрудниках,КодировкаТекста.UTF8);
	Возврат Ответ;

КонецФункции